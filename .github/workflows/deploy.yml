name: Deploy Backend

on:
  push:
    branches:
      - main

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      # Build Docker image
      - name: Build Docker Image
        run: docker build -t nuc_backend:latest .

      # Parar container antigo
      - name: Stop old container
        run: docker stop nuc_api || true && docker rm nuc_api || true

      # Rodar novo container
      - name: Run container
        run: docker run -d --name nuc_api -p 5000:5000 nuc_backend:latest
